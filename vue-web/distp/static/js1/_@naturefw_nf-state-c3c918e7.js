import"./__vendor-dac91350.js";import{r as d,i as $,b as y,p as E,e as O,f as F,t as _}from"./_@vue-bbe7d3f1.js";const L=Symbol("__nf-state__"),f={},v=f,A=(r,t,e={})=>{var s;const o=(s=e.isLocal)!=null?s:!1,h=e.level?e.level:1;if(!o){if(Object.keys(f).includes(r)){const i=new Error().stack;throw console.log(i),`\u5168\u5C40\u72B6\u6001\u7684ID\uFF08${r}\uFF09\u4E0D\u80FD\u91CD\u590D\uFF01`}}let c=null;if($(t))c=t;else if(t.getters||t.actions)c=C(r,t,e);else{const i=t.state?t.state:t;c=D(r,i,e)}const n=h===1?c:y(c);return o?E(r,n):f[r]=n,c},x=r=>{const t=r.store;return Object.keys(t).forEach(e=>{const s=t[e],o=s.options?s.options:{isLocal:!1,isLog:!1,level:1};s.state?A(e,s,o):A(e,{state:s},o)}),typeof r.init=="function"&&r.init(f),(e,s)=>{e.config.globalProperties.$state=f,e.provide(L,v)}},B=(r=L)=>{var t;return(t=O(r))!=null?t:v};class g extends Array{constructor(t){super(),Array.isArray(t)?this.push(...t):this.push(t)}$reset(){this.length=0;const t=typeof this._value=="function"?this._value():this._value;this.push(...t)}$patch(){}set $state(t){this.length=0,Array.isArray(t)?this.push(...t):this.push(t)}pushA(){return this.unshift(...arguments)}pushAt(t,e){console.log(arguments);const s=Array.from(arguments).slice(1);return this.splice(t,0,...s),this.length}deletaA(){return this.shift()}deleteAt(t,e){return this.splice(t,e)}deleteZ(){return this.pop()}swap(t,e){const s=this[t];this[t]=this[e],this[e]=s}}const w=(r,t)=>{const e=_(t);return Object.keys(e).forEach(s=>{switch(typeof e[s]){case"object":Array.isArray(e[s])?(Array.isArray(r[s])?r[s].length=0:r[s]=new g,r[s].push(...e[s])):(r[s]||(r[s]={}),e[s]===null?r[s]=null:w(r[s],e[s]));break;case"bigint":case"boolean":case"number":case"string":r[s]=e[s];break}}),r},u=(r,t)=>{const e=_(t);return Object.keys(e).forEach(s=>{switch(typeof e[s]){case"object":Array.isArray(e[s])?r[s]=new g(e[s]):(r[s]={},u(r[s],e[s]));break;case"bigint":case"boolean":case"number":case"string":r[s]=e[s];break}}),r},b=d({}),p=(r,t,e,s,o={},h=3)=>{if(b[r]||(b[r]={log:[]}),t==="init")return;const n=new Error().stack.split(`
`),i=n.length>h?n[h]:n[n.length-1],l=$(e)?u({},e):e,a=$(s)?u({},s):s,m=$(o)?u({},o):o;b[r].log.push({time:new Date().valueOf(),kind:t,oldValue:l,newValue:a,subValue:m,callFun:i})};class j{constructor(t){if(typeof t=="function"){const e=t();Object.keys(e).forEach(s=>{const o=e[s];Array.isArray(o)?this[s]=new g(o):this[s]=o})}else u(this,t);p(this.$id,"init",{},{})}$reset(){if(!this._value)return;const t=this._value,e=typeof t=="function"?t():u({},t);this.isLog&&p(this.$id,"$reset",this,e),this.$state=e}$patch(t){const e=typeof t=="function"?t(this):t,s=this.isLog?u({},this):"";w(this,e),this.isLog&&p(this.$id,"$patch",s,this,e)}set $state(t){const e=this.isLog?u({},this):"";Object.keys(this).forEach(s=>{delete this[s]}),Object.assign(this,t),this.isLog&&p(this.$id,"$state",e,this,t)}forEach(t){typeof t=="function"&&Object.keys(this).forEach((e,s)=>{const o=this[e];t(o,e,s)})}get log(){return b[this.$id].log}}function C(r,t,e={}){let s=null,o=null;const h=typeof t.state=="function"?t.state():t.state;if(Array.isArray(h)){class i extends g{constructor(a){super(a)}get isLog(){return!!e.isLog}get $id(){return r}}o=i,s=new i(h)}else{class i extends j{constructor(a){super(a)}get isLog(){return!!e.isLog}get _value(){return t.state}get $id(){return r}}o=i,s=new i(h)}const c=d(s),n=e.level?e.level:1;if(n===2){const i=c.$patch;o.prototype.$patch=function(a){i.call(c,a)};const l=c.$reset;o.prototype.$reset=function(a){l.call(c,a)},o.prototype.state=function(a){c.$state=a}}return typeof t.getters=="object"&&Object.keys(t.getters).forEach(i=>{o.prototype[i]=F(()=>{const l=c.isLog?u({},c):"",a=t.getters[i].call(c,c);return c.isLog&&p(c.$id,`getters-${n}-${i}`,l,c,{}),a})}),typeof t.actions=="object"&&Object.keys(t.actions).forEach(i=>{o.prototype[i]=async function(l){const a=c.isLog?u({},c):"";n<4?await t.actions[i].call(c,l,c):await t.actions[i].call(this,l,this),c.isLog&&p(c.$id,`actions-${n}-${i}`,a,c,l)}}),c}function D(r,t,e={}){let s=null;const o=typeof t=="function"?t():t;return Array.isArray(o)?s=new g(t):s=new j(t),s._value=()=>t,s.$id=()=>r,s.isLog=()=>!!e.isLog,d(s)}export{u as a,x as c,A as d,v as s,B as u};
//# sourceMappingURL=_@naturefw_nf-state-c3c918e7.js.map
