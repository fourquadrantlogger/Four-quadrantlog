{"version":3,"file":"data-list-a3bc11de.js","sources":["../../../src/views/base/controller/state-list.js","../../../src/views/base/components/pager.vue","../../../src/views/base/components/grid.vue","../../../src/views/base/data-list.vue"],"sourcesContent":["\r\nimport { watch } from 'vue'\r\n\r\nimport { defineStore, useStore, store } from '@naturefw/nf-state'\r\n\r\nconst flag = Symbol('pager001')\r\n// const flag = 'pager001'\r\n\r\n/**\r\n * 注册局部状态，用 provide 注入\r\n * 数据列表用\r\n * @returns \r\n */\r\nconst regListState = () => {\r\n\r\n  // 定义 列表用的状态\r\n  const state = defineStore(flag, {\r\n    state: () => {\r\n      return {\r\n        moduleId: 0, // 模块ID\r\n        dataList: [],  // 数据列表\r\n        findValue: {}, // 查询条件的精简形式\r\n        findArray: [], // 查询条件的对象形式\r\n        pagerInfo: { // 分页信息\r\n          pagerSize: 5,\r\n          count: 20, // 总数\r\n          pagerIndex: 1 // 当前页号\r\n        },\r\n        selection: { // 列表里选择的记录\r\n          dataId: '', // 单选ID number 、string\r\n          row: {}, // 单选的数据对象 {}\r\n          dataIds: [], // 多选ID []\r\n          rows: [] // 多选的数据对象 []\r\n        },\r\n        query: {} // 查询条件\r\n      }\r\n    },\r\n    getters: {\r\n      nameTest() {\r\n        return this.name + '_通过 getter 获取'\r\n      }\r\n    },\r\n    actions: {\r\n      async loadData(isReset = false) {\r\n        const dbHelp = store.web.dbHelp\r\n        const pager = {\r\n          count: this.pagerInfo.pagerSize,\r\n          start: (this.pagerInfo.pagerIndex - 1) * this.pagerInfo.pagerSize\r\n        }\r\n        const list = await dbHelp.listPager('db_fq_log', this.findValue, pager)\r\n        this.dataList.length = 0\r\n        if (list.dataList.length > 0) {\r\n          this.dataList.push(...list.dataList)\r\n        }\r\n        if (isReset) {\r\n          this.pagerInfo.count = list.allCount === 0  ? 1 : list.allCount\r\n          this.pagerInfo.pagerIndex = 1\r\n        }\r\n      }\r\n    }\r\n  },{isLocal: true})\r\n  \r\n  // 初始化\r\n  state.loadData(true)\r\n\r\n  // 分页功能\r\n  watch(() => state.pagerInfo.pagerIndex, (index) => {\r\n    state.loadData()\r\n  })\r\n\r\n  // 更换查询条件\r\n  watch(state.findValue, () => {\r\n    state.loadData(true)\r\n  })\r\n\r\n  return state\r\n\r\n}\r\n\r\n/**\r\n * 用 inject 获取状态\r\n * @returns \r\n */\r\nconst getListState = () => {\r\n  return useStore(flag)\r\n}\r\n\r\n\r\nexport {\r\n  getListState,\r\n  regListState\r\n}","<template>\r\n  <el-pagination\r\n    background\r\n    layout=\"prev, pager, next\"\r\n    v-model:currentPage=\"state.pagerInfo.pagerIndex\"\r\n    :page-size=\"state.pagerInfo.pagerSize\"\r\n    :total=\"state.pagerInfo.count\"\r\n  >\r\n  </el-pagination>\r\n</template>\r\n\r\n<script>\r\n/* eslint-disable vue/no-v-model-argument */\r\n  import { ElPagination } from 'element-plus'\r\n  // 局部状态\r\n  import { getListState } from '../controller/state-list.js'\r\n\r\n</script>\r\n\r\n<script setup>\r\n  const state = getListState()\r\n  const props = defineProps({\r\n  })\r\n\r\n</script>\r\n","<template>\r\n  <nf-grid\r\n    v-grid-drag=\"gridMeta\"\r\n    :dataList=\"state.dataList\"\r\n    v-bind=\"gridMeta\"\r\n    :selection=\"state.selection\"\r\n  >\r\n  </nf-grid>\r\n</template>\r\n\r\n<script>\r\n  import { store } from '@naturefw/nf-state'\r\n  // 局部状态\r\n  import { getListState } from '../controller/state-list.js'\r\n\r\n</script>\r\n\r\n<script setup>\r\n  // 获取列表状态\r\n  const state = getListState()\r\n\r\n  // 获取表单控件需要的meta\r\n  const { gridMeta } = store.meta[state.moduleId]\r\n</script>\r\n","<template>\r\n  <!--查询控件 延迟加载-->\r\n  <div style=\"height: 65px;\">\r\n    <component\r\n      :is=\"delay[delayKind.find]\"\r\n      :moduleId=\"moduleId\"\r\n    >\r\n    </component>\r\n  </div>\r\n  <!--操作按钮 延迟加载-->\r\n  <div style=\"height: 30px;\">\r\n    <component\r\n      :is=\"delay[delayKind.button]\"\r\n      :moduleId=\"moduleId\"\r\n    >\r\n    </component>\r\n  </div>\r\n  <!--列表控件-->\r\n  <my-grid></my-grid>\r\n  <!--分页-->\r\n  <my-pager></my-pager>\r\n  列表数据的状态：\r\n  <div v-for=\"(item, key) in state\">\r\n    {{key}}： \r\n    <div style=\"padding-left: 20px;\"\r\n      v-if=\"key === 'selection'\">\r\n      <div v-for=\"(item2, key2) in item\">\r\n        {{key2}}： {{item2}}\r\n      </div>\r\n    </div>\r\n    <span v-else>\r\n      {{item}}\r\n    </span>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n/**\r\n * 数据列表的基础页面\r\n */\r\n  import { reactive, watch, defineAsyncComponent } from 'vue'\r\n  // import { ElPagination, ElInput } from 'element-plus'\r\n\r\n  // 局部状态，注册列表数据的状态\r\n  import { regListState } from './controller/state-list.js'\r\n\r\n  // 分页组件\r\n  import myPager from './components/pager.vue'\r\n  // 列表组件\r\n  import myGrid from './components/grid.vue'\r\n  // 查询组件 -- 延迟加载\r\n  const _find = defineAsyncComponent(() => import('./components/find.vue'))\r\n  // 按钮组件 -- 延迟加载\r\n  const _button = defineAsyncComponent(() => import('./components/button.vue'))\r\n \r\n</script>\r\n\r\n<script setup>\r\n  // 注册状态\r\n  const state = regListState()\r\n  state.moduleId = 'm_log'\r\n\r\n  // 当前激活的模块\r\n  // const { active } = useActive(moduleId)\r\n\r\n  // 延迟加载\r\n  const delay = {\r\n    load: '',\r\n    find: _find,\r\n    button: _button\r\n  }\r\n  const delayKind = reactive({\r\n    find: 'load',\r\n    button: 'load'\r\n  })\r\n\r\n  setTimeout(() => {\r\n    delayKind.find = 'find'\r\n    delayKind.button = 'button'\r\n  }, 1)\r\n \r\n\r\n</script>\r\n\r\n"],"names":[],"mappings":"6WAKA,KAAM,GAAO,OAAO,UAAU,EAQxB,EAAe,IAAM,CAGzB,KAAM,GAAQ,EAAY,EAAM,CAC9B,MAAO,IACE,EACL,SAAU,EACV,SAAU,CAAE,EACZ,UAAW,CAAE,EACb,UAAW,CAAE,EACb,UAAW,CACT,UAAW,EACX,MAAO,GACP,WAAY,CACb,EACD,UAAW,CACT,OAAQ,GACR,IAAK,CAAE,EACP,QAAS,CAAE,EACX,KAAM,CAAE,CACT,EACD,MAAO,CAAE,CACV,GAEH,QAAS,CACP,UAAW,CACT,MAAO,MAAK,KAAO,mCACpB,CACF,EACD,QAAS,MACD,UAAS,EAAU,GAAO,CAC9B,KAAM,GAAS,EAAM,IAAI,OACnB,EAAQ,CACZ,MAAO,KAAK,UAAU,UACtB,MAAQ,MAAK,UAAU,WAAa,GAAK,KAAK,UAAU,SACzD,EACK,EAAO,KAAM,GAAO,UAAU,YAAa,KAAK,UAAW,CAAK,EACtE,KAAK,SAAS,OAAS,EACnB,EAAK,SAAS,OAAS,GACzB,KAAK,SAAS,KAAK,GAAG,EAAK,QAAQ,EAEjC,GACF,MAAK,UAAU,MAAQ,EAAK,WAAa,EAAK,EAAI,EAAK,SACvD,KAAK,UAAU,WAAa,EAE/B,CACF,CACL,EAAI,CAAC,QAAS,EAAI,CAAC,EAGjB,SAAM,SAAS,EAAI,EAGnB,EAAM,IAAM,EAAM,UAAU,WAAY,AAAC,GAAU,CACjD,EAAM,SAAU,CACpB,CAAG,EAGD,EAAM,EAAM,UAAW,IAAM,CAC3B,EAAM,SAAS,EAAI,CACvB,CAAG,EAEM,CAET,EAMM,EAAe,IACZ,EAAS,CAAI,uBChEpB,KAAM,GAAQ,EAAc,igBCD5B,KAAM,GAAQ,EAAc,EAGtB,CAAE,YAAa,EAAM,KAAK,EAAM,4cC6BhC,EAAQ,EAAqB,IAAM,EAAA,IAAA,OAAA,sBAAA,kBAAA,CAA+B,EAElE,EAAU,EAAqB,IAAM,EAAiC,IAAA,OAAA,wBAAA,kBAAA,CAAA,cAM5E,KAAM,GAAQ,EAAc,EAC5B,EAAM,SAAW,QAMjB,KAAM,GAAQ,CACZ,KAAM,GACN,KAAM,EACN,OAAQ,CACT,EACK,EAAY,EAAS,CACzB,KAAM,OACN,OAAQ,MACZ,CAAG,EAED,kBAAW,IAAM,CACf,EAAU,KAAO,OACjB,EAAU,OAAS,QACpB,EAAE,CAAC"}