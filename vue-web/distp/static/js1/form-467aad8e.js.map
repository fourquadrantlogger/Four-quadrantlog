{"version":3,"file":"form-467aad8e.js","sources":["../../../src/views/base/controller/state-form.js","../../../src/views/base/components/form.vue"],"sourcesContent":["\r\nimport { watch } from 'vue'\r\n\r\nimport { defineStore, useStore, store, deepClone } from '@naturefw/nf-state'\r\n\r\n\r\nconst flag = Symbol('form001')\r\n// const flag = 'pager001'\r\n\r\n/**\r\n * 注册局部状态，用 provide 注入。\r\n * 表单用\r\n * @returns \r\n */\r\nconst regFormState = () => {\r\n  const dbHelp = store.web.dbHelp\r\n\r\n  // 定义 表单用的状态\r\n  const state = defineStore(flag, {\r\n    state: {\r\n      moduleId: 0,\r\n      model: {\r\n        id: '1', // \r\n        title: '标题', // 100 标题\r\n        quadrant: '', // 101 象限\r\n        atype: '分类', // 102 分类\r\n        detail: '内容', // 103 内容\r\n        review: '思考', // 104 思考\r\n        blob: '', // 105 图片\r\n        location: '', // 106 \r\n        ctime: new Date() // 110 \r\n      },\r\n      state: 'add' // add、update、、\r\n    },\r\n    getters: {\r\n      nameTest() {\r\n        return this.name + '_通过 getter 获取'\r\n      }\r\n    },\r\n    actions: {\r\n      submit(val) {\r\n        // 判断是添加还是修改\r\n        this.name = val\r\n        // 添加\r\n        console.log(dbHelp)\r\n        this.model.id = new Date().valueOf()\r\n        const _model = deepClone({}, this.model)\r\n        _model.quadrant = this.model.quadrant.join(',')\r\n\r\n        dbHelp.addModel('db_fq_log', _model).then((res) => {\r\n          console.log('添加成功', res)\r\n        })\r\n      }\r\n    }\r\n  },{isLocal: true})\r\n  \r\n  return state\r\n\r\n}\r\n\r\n/**\r\n * 用 inject 获取状态\r\n * @returns \r\n */\r\nconst getFormState = () => {\r\n  return useStore(flag)\r\n}\r\n\r\n\r\nexport {\r\n  getFormState,\r\n  regFormState\r\n}","<template>\r\n  <!--表单-->\r\n  <el-row :gutter=\"20\">\r\n    <el-col :span=\"23\">\r\n      <nf-form\r\n        v-form-drag=\"formMeta\"\r\n        :model=\"model\"\r\n        v-bind=\"formMeta\"\r\n      >\r\n      </nf-form>\r\n    </el-col>\r\n\r\n    <el-col :span=\"8\">\r\n    </el-col>\r\n    <el-col :span=\"8\">\r\n      <el-button type=\"\" @click=\"save\">保存</el-button>\r\n    </el-col>\r\n  </el-row>\r\n</template>\r\n\r\n<script>\r\n  import { reactive, watch, onMounted, nextTick } from 'vue'\r\n  import { store } from '@naturefw/nf-state'\r\n  import { ElCol, ElRow, ElSlider } from 'element-plus'\r\n  // import { createModel, lifecycle } from '@naturefw/ui-core'\r\n  // 局部状态\r\n  import { getListState } from '../controller/state-list.js'\r\n  import { regFormState } from '../controller/state-form.js'\r\n\r\n</script>\r\n\r\n<script setup>\r\n  const props = defineProps({\r\n    moduleId: [Number, String],\r\n    dataId: [Number, String],\r\n    formMetaId: [Number, String],\r\n    actionId: [Number, String],\r\n    type: [Number, String],\r\n    dialogInfo: [Object]\r\n  })\r\n\r\n  // 获取列表状态\r\n  const state = getListState()\r\n\r\n  // 注册表单状态\r\n  const modelManage = regFormState()\r\n  const model = modelManage.model\r\n\r\n  // 获取表单控件需要的meta\r\n  const { formMeta } = store.meta[state.moduleId]\r\n\r\n  // 添加或者修改\r\n  const save = () => {\r\n    modelManage.submit()\r\n  }\r\n\r\n</script>\r\n"],"names":[],"mappings":"8sBAMA,KAAM,GAAO,OAAO,SAAS,EAQvB,EAAe,IAAM,CACzB,KAAM,GAAS,EAAM,IAAI,OAyCzB,MAtCc,GAAY,EAAM,CAC9B,MAAO,CACL,SAAU,EACV,MAAO,CACL,GAAI,IACJ,MAAO,eACP,SAAU,GACV,MAAO,eACP,OAAQ,eACR,OAAQ,eACR,KAAM,GACN,SAAU,GACV,MAAO,GAAI,KACZ,EACD,MAAO,KACR,EACD,QAAS,CACP,UAAW,CACT,MAAO,MAAK,KAAO,mCACpB,CACF,EACD,QAAS,CACP,OAAO,EAAK,CAEV,KAAK,KAAO,EAEZ,QAAQ,IAAI,CAAM,EAClB,KAAK,MAAM,GAAK,GAAI,MAAI,EAAG,QAAS,EACpC,KAAM,GAAS,EAAU,GAAI,KAAK,KAAK,EACvC,EAAO,SAAW,KAAK,MAAM,SAAS,KAAK,GAAG,EAE9C,EAAO,SAAS,YAAa,CAAM,EAAE,KAAK,AAAC,GAAQ,CACjD,QAAQ,IAAI,2BAAQ,CAAG,CACjC,CAAS,CACF,CACF,CACL,EAAI,CAAC,QAAS,EAAI,CAAC,CAInB,uLChBE,KAAM,GAAQ,EAAc,EAGtB,EAAc,EAAc,EAC5B,EAAQ,EAAY,MAGpB,CAAE,YAAa,EAAM,KAAK,EAAM,UAGhC,EAAO,IAAM,CACjB,EAAY,OAAQ,CACrB"}