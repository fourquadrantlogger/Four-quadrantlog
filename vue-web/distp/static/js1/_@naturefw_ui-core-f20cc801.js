import"./__vendor-1809b355.js";import{i as E,a as I,t as D,b as M}from"./_@naturefw_nf-tool-dc0d917c.js";import{f as g,w as y,g as S,h as v,r as b,j as A,n as C}from"./_@vue-5657e7be.js";var w={baseUrl:"/",axios:{}};function k(e,l="",c=null){return new Promise((t,o)=>{const s=`/${e}${l?"?"+l:""}`;c===null?w.axios.get(s).then(n=>{t(n.data)}).catch(n=>{o(n)}):w.axios.post(s,c).then(n=>{t(n.data)}).catch(n=>{o(n)})})}const U={columnId:{type:[Number,String],default:()=>Math.floor(Math.random()*1e6+1)},model:Object,colName:String,controlType:Number,optionList:{type:Array,default:()=>[]},webapi:{type:Object,default:()=>({serviceId:null,actionId:"",dataId:"",body:null,cascader:{lazy:!1,actions:["",""]}})},delay:{type:Number,default:0},events:{type:Object,default:()=>({input:()=>{},enter:()=>{},keydown:()=>{}})},size:{type:String,default:"small",validator:e=>["large","default ","small"].indexOf(e)!==-1},clearable:{type:Boolean,default:!0},extend:{type:Object,default:()=>({})}},Q={model:Object,partModel:Object,colOrder:{type:Array,default:()=>[]},formColCount:{type:Number,default:1},labelSuffix:{type:String,default:"\uFF1A"},labelWidth:{type:String,default:"130px"},size:{type:String,default:"mini"},itemMeta:{type:Object,default:()=>({})},subs:{type:Object,default:()=>({})},ruleMeta:{type:Object,default:()=>({})},formColShow:{type:Object,default:()=>({})},customerControl:{type:Object,defaule:()=>({})},reload:{type:Boolean,default:!1},reset:{type:Function,default:()=>{}},events:{type:Object,default:()=>({})}},G={moduleId:[Number,String],active:Object,colOrder:{type:Array,default:()=>[]},findValue:{type:Object,default:()=>{}},findArray:{type:Object,default:()=>[]},quickFind:{type:Array,default:()=>[]},allFind:{type:Array,default:()=>[]},customer:{type:Array,default:()=>{}},customerDefault:{type:Array,default:1},reload:{type:Boolean,default:!1},itemMeta:{type:Object,default:()=>{}}},J={moduleId:{type:Number,required:!0},height:{type:Number,default:300},stripe:{type:Boolean,default:!0},border:{type:Boolean,default:!0},highlightCurrentRow:{type:Boolean,default:!0},colOrder:{type:Array,default:()=>[]},fixedIndex:{type:Number,default:0},idName:{type:String,default:"ID"},itemMeta:Object,selection:{type:Object,default:()=>({dataId:"",row:{},dataIds:[],rows:[]})},"data-list":{type:Array,default:()=>[]}},K=(e,l,c)=>{const t=[],o=e.filter(s=>s.parentId==l);for(let s=0;s<o.length;s++)t.push({value:o[s].value,label:o[s].label,leaf:!1,children:[...K(e,o[s].value)]}),t[t.length-1].children.length===0&&(delete t[t.length-1].children,t[t.length-1].leaf=!0);return t},x=(e,l,c)=>{const t=[];if(e.levelName.length===c)return t;{const s=e.levelName[c],n=e[s].filter(r=>r.parentId===l);for(let r=0;r<n.length;r++)t.push({value:n[r].value,label:n[r].label,leaf:!1,children:[...x(e,n[r].value,c+1)]}),t[t.length-1].children.length===0&&(delete t[t.length-1].children,t[t.length-1].leaf=!0);return t}},Z=e=>{const l=[],c=e.levelName,t=e[c[0]];for(let o=0;o<t.length;o++)l.push({value:t[o].value,label:t[o].label,leaf:!1,children:[...x(e,t[o].value,1)]}),l[l.length-1].children.length===0&&(delete l[l.length-1].children,l[l.length-1].leaf=!0);return l};function p(e){return g((l,c)=>({get(){return l(),e.model[e.colName]},set(t){c(),e.model[e.colName]=t}}))}function T(e,l={},c=()=>{},t=500,o="modelValue"){let s=null,n=e[o];return l.run=()=>{clearTimeout(s),c(`update:${o}`,n)},l.clear=()=>{clearTimeout(s)},g((r,i)=>(y(()=>e[o],a=>{n=a,i()}),{get(){return r(),n},set(a){n=a,i(),clearTimeout(s),s=setTimeout(()=>{c(`update:${o}`,a)},t)}}))}function ee(e){const{webapi:l,optionList:c}=e;return{loadDict:()=>{if(l.serviceId!==null){const s=`${l.serviceId===""?"":l.serviceId}${l.actionId===""?"":l.actionId}${l.dataId===""?"":l.dataId}`;k(s,"").then(n=>{Array.isArray(n)&&(c.length=0,c.push(...n))}).catch(n=>{console.error("\u540E\u7AEF\u53CD\u9988 - err",n)})}},loadDictById:(s,n)=>new Promise((r,i)=>{if(l.serviceId!==null){const a=`${l.serviceId===""?"":l.serviceId}/${s}/${n}`;k(a,"").then(u=>{Array.isArray(u)?r(u):i({err:"\u4E0D\u662F\u6570\u7EC4"})}).catch(u=>{i(u)})}})}}function j(e,l){return g((c,t)=>({get(){c();const o=[];return l.forEach(s=>{o.push(e.model[s])}),o},set(o){t(),e.model[e.colName]=o,l.forEach((s,n)=>{e.model[s]=n<o.length?o[n]:""})}}))}function L(e,l={},c=500){let t=null,o=e.model[e.colName];return l.run=()=>{clearTimeout(t),e.model[e.colName]=o},l.clear=()=>{clearTimeout(t)},g((s,n)=>(y(()=>e.model[e.colName],r=>{o=r,n()}),{get(){return s(),o},set(r){o=r,n(),clearTimeout(t),t=setTimeout(()=>{e.model[e.colName]=o},c)}}))}function _(e,l=()=>{},c="modelValue"){return g((t,o)=>({get(){return t(),e[c]},set(s){o(),l(`update:${c}`,s)}}))}function te(e,l){const{events:c}=e,t={run:()=>{},clear:()=>{}},o=()=>{t.run()},s=u=>{u.key!=="Backspace"&&t.clear()},n=()=>{c.input()};let r=null,i=!1,a=null;if(typeof e.colName=="string"&&(a=e.colName.split("_"),i=a.length>1),i)r=j(e,a);else{const u=typeof e.model=="object"&&e.model!==null;e.delay===0?u?r=p(e):r=_(e,l):u?r=L(e,t,e.delay):r=T(e,t,l,e.delay)}return{value:r,run:o,clear:s,myinput:n}}const B=(e,l)=>{const c=b({});return l.forEach(t=>{const o=e[t];switch(o.controlType){case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 130:case 131:c[o.colName]="";break;case 120:case 121:case 122:case 124:case 123:c[o.colName]="";break;case 130:c[o.colName]="";break;case 131:c[o.colName]="";break;case 110:case 111:c[o.colName]=0;break;case 150:case 151:c[o.colName]=!1;break;case 153:case 160:c[o.colName]=null;break;case 164:o.colName.split(",").forEach(s=>{c[s]=""});break;case 152:case 161:c[o.colName]=[];break;case 170:c[o.colName]=[];break}if(typeof o.defValue!="undefined"&&o.controlType!==162)switch(o.defValue){case"":break;case"{}":c[o.colName]={};break;case"[]":c[o.colName]=[];break;case"{{now}}":c[o.colName]=new Date;break;default:c[o.colName]=o.defValue;break}}),c},F=e=>{const l=b({}),c=()=>{const t=e.formColCount,o=24/t,s=e.itemMeta;for(const n in s){const r=s[n];typeof r.colCount=="number"?t===1?l[r.columnId]=r.colCount>=1?o:o/(0-r.colCount):l[r.columnId]=r.colCount<1?o:o*r.colCount:l[r.columnId]=o}};return y(()=>e.formColCount,t=>{c()},{immediate:!0}),y(e.itemMeta,t=>{c()}),{formColSpan:l,setFormColSpan:c}},$=(e,l)=>{const c=e.partModel||{},t=e.model,o=e.itemMeta;for(const s in c)delete c[s];for(const s in l)if(l[s]){const n=o[s].colName;c[n]=t[n]||""}},P=e=>{const l=b({}),c=()=>{if(typeof e.itemMeta=="object")for(const o in e.itemMeta)l[o]=!0},t=()=>{if(c(),typeof e.formColShow=="object"&&Object.keys(e.formColShow).length>0){for(const o in e.formColShow){const s=e.formColShow[o],n=e.itemMeta[o].colName;y(()=>e.model[n],(r,i)=>{if(typeof s[r]!="undefined"){if(E(r))s[r].forEach(a=>{let u=a,d=r;if(I(a)){u=a[0];const f=e.itemMeta[u].colName;e.model[f]=a[1]}M(u)&&(d=!r),l[u]=d});else{for(const a in e.itemMeta)l[a]=!1;s[r].forEach(a=>{l[a]=!0})}$(e,l)}},{immediate:!0})}typeof e.partModel!="undefined"&&y(e.model,()=>{for(const o in e.model)typeof e.partModel[o]!="undefined"&&(e.partModel[o]=e.model[o])})}};return t(),y(()=>e.colOrder,o=>{o.forEach(s=>{l[s]=!0})}),y(e.formColShow,o=>{t()}),{showCol:l,setFormColShow:t}};function le(e,l){const c=e.model,{itemMeta:t,ruleMeta:o,colOrder:s}=e,n=B(t,s);if(Object.keys(c).length<Object.keys(n).length)for(const d in n)typeof c[d]=="undefined"&&(c[d]=n[d]);const{formColSpan:r,setFormColSpan:i}=F(e),{showCol:a,setFormColShow:u}=P(e);for(const d in t)o[d];return y(e.colOrder,()=>{u(),i()}),e.events.reset=()=>{u()},{formColSpan:r,showCol:a,setFormColShow:u}}function R(e){const l=b({});for(const c in e){const t=e[c];switch(l[t.columnId]={dateKind:0,findKind:[],useKind:401,value:"",value2:""},t.controlType){case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 130:case 131:l[t.columnId].findKind=[401,402,403,404,405,406];break;case 110:case 111:case 112:case 114:case 113:l[t.columnId].findKind=[401,417,413,414,415,416];break;case 115:l[t.columnId].findKind=[401,417,413,414,415,416];break;case 116:l[t.columnId].findKind=[401,417,413,414,415,416];break;case 120:case 121:l[t.columnId].findKind=[401,417,413,414,415,416,441],l[t.columnId].value=void 0,l[t.columnId].value2=void 0;break;case 150:case 151:l[t.columnId].findKind=[401];break;case 153:case 160:l[t.columnId].findKind=[401,441];break;case 162:l[t.columnId].findKind=[401,441],l[t.columnId].value=[];break;case 152:case 161:l[t.columnId].findKind=[401,441],l[t.columnId].value=[];break}}return l}const oe={401:{id:401,name:" = ",where:"{col} = ?"},402:{id:402,name:"\u4E0D\u7B49\u4E8E",where:"{col} <> ?"},403:{id:403,name:"\u5305\u542B",where:'{col} like "%?%"'},404:{id:404,name:"\u4E0D\u5305\u542B",where:'{col} not like "%?%"'},405:{id:405,name:"\u8D77\u59CB\u4E8E",where:'{col} like "?%"'},406:{id:406,name:"\u7ED3\u675F\u4E8E",where:'{col} like "%?"'},407:{id:407,name:"\u975E\u8D77\u59CB",where:'{col} not like "?%"'},408:{id:408,name:"\u975E\u7ED3\u675F",where:'{col} not like "%?"'},413:{id:413,name:" > ",where:"{col} > ?"},414:{id:414,name:" >= ",where:"{col} >= ?"},415:{id:415,name:" < ",where:"{col} < ?"},416:{id:416,name:" <= ",where:"{col} <= ?"},417:{id:417,name:"\u4ECE",where:"{col} between ? and ?"},418:{id:418,name:"\u4ECE",where:"{col} > ? and {col} <= ?"},419:{id:419,name:"\u4ECE",where:"{col} >= ? and {col} < ?"},440:{id:440,name:" \u5305\u542B ",where:"( {col} like %?% or {col} like %?% ... ) "},441:{id:441,name:" \u5305\u542B ",where:"{col} in (?)"},442:{id:442,name:" \u4E0D\u5305\u542B ",where:"{col} not in (?)"}};function X(e,l){let c=!1;const t=o=>{if(o.key==="Alt"){c=!0;return}o.key===e&&l(o,c),c=!1};v(o=>{document.addEventListener("keydown",t)}),A(o=>{document.removeEventListener("keydown",t)})}const W=e=>{switch(D(e)){case"null":case"undefined":return!0;case"string":return e.length===0;case"number":case"bigInt":return isNaN(e);case"array":return e.length===0;default:return!1}},V=(e,l,c)=>{const t=[],o=e.split(",");let s=0;return o.forEach(n=>{s<l.value.length?(t.push({colName:n,findKind:l.useKind,value:l.value[s]}),c[n]=[l.useKind,l.value[s]]):delete c[n],s++}),t},z=(e,l)=>{e.split(",").forEach(t=>{delete l[t]})};function ne(e){const l=S(null);v(()=>{});const c=()=>{l.value.resetFields()},t=b({isShow:!1}),o=()=>{t.isShow=!0},s=R(e.itemMeta),n=b(e.quickFind),r=e.findValue,i=e.findArray,a=e.itemMeta;return X("b",(u,d)=>{d&&e.active.moduleId===e.moduleId&&(t.isShow=!0)}),y(s,()=>{t.isShow&&(n.length=0),i.length=0;for(const u in s){const d=a[u].colName,f=a[u].columnId,h=a[u].controlType,m=s[u];W(m.value)?h===162?z(d,r):delete r[d]:(t.isShow&&n.push(f),m.useKind>=417&&m.useKind<=419?(r[d]=[m.useKind,[m.value,m.value2]],i.push({colName:d,findKind:m.useKind,valueStart:m.value,valueEnd:m.value2})):h===162?i.push(...V(d,m,r)):(r[d]=[m.useKind,m.value],i.push({colName:d,findKind:m.useKind,value:m.value})))}}),{resetForm:c,moreOpen:o,dialogInfo:t,findModel:s,arrQuickFind:n,formControl:l}}function ce(){return{setDialog:(c,t,o,s)=>{const n=document.documentElement.clientWidth,r=document.documentElement.clientHeight;let i=s;i=n*(100-i)/200;const a={x:i,y:r*15/100};t.style.marginTop=a.y+"px",t.style.marginLeft=a.x+"px";const u={x:0,y:0},d={x:0,y:0};o.onmouseover=f=>{o.style.cursor="move"},o.onmousedown=f=>{t.style.marginTop==="15vh"&&(a.y=r*15/100),u.x=f.clientX,u.y=f.clientY,o.style.cursor="move"},c.onmousemove=f=>{u.x!==0&&(d.x=f.clientX-u.x,d.y=f.clientY-u.y,t.style.marginLeft=a.x+d.x+"px",t.style.marginTop=a.y+d.y+"px")},c.onmouseup=f=>{u.x!==0&&(d.x=f.clientX-u.x,d.y=f.clientY-u.y,a.x+=d.x,a.y+=d.y,o.style.cursor="",t.style.marginLeft=a.x+"px",t.style.marginTop=a.y+"px",u.x=0)}},unload:(c,t)=>{t.onmouseover=null,t.onmousedown=null,c.onmousemove=null,c.onmouseup=null}}}class N{constructor(l,c,t,o,s){this.dom=l,this.align=()=>{},this.order=()=>{},this.delDom=()=>{},this.dom.onclick=n=>{n.ctrlKey&&typeof c.domEvents.click=="function"&&c.domEvents.click(o)},this.dom.setAttribute("draggable",!0),this.dom.ondragstart=null,this.dom.ondragstart=n=>{t.state="pending",t.sourceId=o,t.sourceIndex=c.colOrder.findIndex(r=>r===t.sourceId)},this.dom.ondragover=null,this.dom.ondragover=n=>{n.preventDefault(),clearTimeout(t.timeout),t.oldDom=n.target,t.isLeft=n.offsetX<n.target.offsetWidth/2,n.ctrlKey?n.target.style.border="2px dotted #ec5367":t.isLeft?n.target.style.border="2px dotted #eb982c":n.target.style.border="2px dotted #2140c9"},this.dom.ondragleave=null,this.dom.ondragleave=n=>{clearTimeout(t.timeout),t.oldDom.style.border="",t.timeout=setTimeout(()=>{t.state!=="end"&&this.delDom(t,n)},1e3)},this.dom.ondrop=null,this.dom.ondrop=n=>{clearTimeout(t.timeout),t.oldDom.style.border="",t.state="end",t.offsetX=n.offsetX,t.isLeft=t.offsetX<n.target.offsetWidth/2,t.ctrl=n.ctrlKey,t.targetId=o,t.targetIndex=c.colOrder.findIndex(r=>r===t.targetId),t.sourceId===t.targetId?this.align(t,n):this.order(t,n)}}setAlign(l){this.align=l}setOrder(l){this.order=l}deleteDom(l){this.delDom=l}}function O(e,l){const c=()=>{e.colOrder[l.sourceIndex]=l.targetId,e.colOrder[l.targetIndex]=l.sourceId},t=()=>{const o=l.isLeft?0:1,s=l.sourceIndex<l.targetIndex?0:1;e.colOrder.splice(l.targetIndex+o,0,l.sourceId),e.colOrder.splice(l.sourceIndex+s,1)};l.ctrl?c():t()}function re(e,l,c){const t=r=>{const i=e.itemMeta[r.sourceId];c(i,()=>{e.colOrder.splice(r.sourceIndex,1),C(()=>{n()})})},o=(r,i)=>{const a=i.ctrl?"header-align":"align",u=r.itemMeta[i.sourceId];switch(u[a]){case"left":i.isLeft?u[a]="left":u[a]="center";break;case"center":i.isLeft?u[a]="left":u[a]="right";break;case"right":i.isLeft?u[a]="center":u[a]="right";break}},s=r=>{setTimeout(()=>{const i=Array.from(l.rows[0].cells);let a=-1;i.forEach(u=>{a===-1?a=0:e.itemMeta[e.colOrder[a++]].width=u.offsetWidth})},1e3)},n=()=>{l.addEventListener("mouseup",s);const r=l.rows[0],i=r.cells.length,a={timeout:null,oldDom:{style:{border:""}},state:"",offsetX:0,isLeft:!0,ctrl:!1,sourceId:"",targetId:"",sourceIndex:0,targetIndex:0};for(let u=1;u<i;u++){const d=r.cells[u],f=e.colOrder[u-1],h=new N(d,e,a,f,l);h.setAlign(m=>{o(e,m)}),h.setOrder(m=>{O(e,a),C(()=>{n()})}),h.deleteDom(m=>{t(a)})}document.ondrop=u=>{}};return{girdSetup:n}}function se(e,l,c){const t=n=>{const r=e.itemMeta[n.sourceId];c(r,()=>{e.colOrder.splice(n.sourceIndex,1),C(()=>{s()})})},o=(n,r)=>{if(r.ctrl)r.isLeft?n.formColCount>1&&n.formColCount--:n.formColCount<8&&n.formColCount++;else{const i=r.sourceId,a=n.itemMeta[i];typeof a.colCount!="number"&&(a.colCount=1);const u=a.colCount;r.isLeft?(u>-7&&a.colCount--,a.colCount===0&&(a.colCount=-2)):(u<8&&a.colCount++,a.colCount===-1&&(a.colCount=1))}},s=()=>{const n={timeout:null,oldDom:{style:{border:""}},state:"",offsetX:0,isLeft:!0,ctrl:!1,sourceId:"",targetId:"",sourceIndex:0,targetIndex:0},r=Array.from(l.children);let i=0;r.forEach(a=>{const u=a.children[0].children[0];a.children[0].children[1];const d=e.colOrder[i++],f=new N(u,e,n,d,l);f.setAlign(h=>{o(e,h)}),f.setOrder(h=>{O(e,n),setTimeout(()=>{s()},1e3)}),f.deleteDom(h=>{t(n)})}),document.ondrop=a=>{}};return{setup:s}}export{U as a,re as b,le as c,ce as d,Q as e,se as f,K as g,oe as h,te as i,ne as j,G as k,ee as l,X as m,J as n,Z as s};
//# sourceMappingURL=_@naturefw_ui-core-f20cc801.js.map
